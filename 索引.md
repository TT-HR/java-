什么是索引？

- 索引相当于字典中的目录页，避免了全表查询数据的情况，能够快速定位需要查找的数据的位置并响应。

为什么要用索引？索引的优缺点分析：

- **索引的优点**：
  - 索引可以大大加速数据的检索速度(减少检索的数据量)，这也是创建索引最主要的原因。
- **索引的缺点**：
  - 创建索引和维护索引需要耗费许多时间，当表中数据有修改更新时，如果数据存在索引，那么索引也需要进行动态的修改，会降低sql的执行效率
  - 占用物理存储空间：索引需要使用屋里文件存储，会耗费一定空间

B树和B+树的区别

1. B树的所有节点既存放key也存放数据data，而B+树只有叶子节点存放key和data，其他节点只存放key
2. B树的叶子节点都是独立的，B+树的叶子节点有一条引用链指向与它相邻的子节点
3. B树的检索过程相当于对范围内的每个节点的关键字做二分查找，可能还没有到达叶子节点，检索就结束了。而B+树的检索效率就很稳定了，任何查找都是从根节点到叶子节点的过程，叶子节点的顺序检索很明显。

hash索引和B+树索引的区别和优缺点分析

- hash索引优点：
  1. hash索引定位速度快，能够在很短的时间内根据hash函数定位到数据所在的位置。
- 缺点：
  1. hash索引会存在hash冲突的问题
  2. hash索引不支持顺序和范围查询，只针对查询单条数据较多的库优化较好

索引类型：

1. 主键索引

   - 数据表的主键列使用的就是主键索引，一张数据表只能有一个主键索引，并且主键不能为null，不能重复，在mysql的InnoDB中，如果没有显式指定表的主键，InnoDB会自动检查表中是否有唯一索引的字段，如果有，则选择该字段为默认主键，否则会自动创建一个6Byte的自增主键。

2. 二级索引(又叫辅助索引)

   - **二级索引的叶子节点的data域存储的是主键，换句话说，相当于根据辅助索引可以定位到主键的位置**

     唯一索引、普通索引、前缀索引等都属于二级索引

     - **唯一索引**：唯一索引也是一种约束，唯一索引的属性列不能出现重复的数据，但是允许数据为null，一张表允许创建多个唯一索引，大部分情况下，唯一索引是为了数据的唯一性，而不是为了查询效率
     - **普通索引**：普通索引的唯一作用就是为了快速查询数据，一张表可以创建多个普通索引，允许数据重复或者null
     - **前缀索引**：前缀索引只适用于字符串类型的数据。是针对文本数据的前几个字符创建索引，相比普通索引建立的数据更小。
     - **全文索引**：全文索引主要是为了检索大文本数据中的关键字的信息，是目前搜索引擎数据库中使用的一种技术，mysql5.6之前只有MyISAM支持全文索引，5.6只有InnoDB也支持了全文索引

聚集索引和非聚集索引

- **聚集索引即索引结构和数据存放在一起的索引，主键索引属于聚集索引。**

  - 聚集索引的优点

    聚集索引的查询速度非常快，因为整个B+树本身就是一个多叉平衡树，叶子节点也是有序的，定位到了索引的节点就相当于是定位到了数据。

  - 聚集索引的缺点

    依赖于有序的数据：如果索引的数据不是有序的，那么就需要在插入时排序，如果数据不是整形数据而是UUID或者字符串这种数据，插入和查找的速度会有所降低。

  - 更新代价较大：如果对索引列的数据被修改时，那么对应的索引也会被修改，所以对于主键索引来说，主键一般都是不可修改的

- **非聚集索引即索引结构和数据分开存放的索引，二级索引(辅助索引)属于非聚集索引**

  > 非聚集索引的叶子节点并不一定存放数据的指针，因为二级索引的叶子节点就存放的是主键，根据主键重新回表查询数据

- 非聚集索引的优点：

  更新代价相对于聚集索引来说比较小

- 非聚集索引的缺点：

  和聚集索引一样，非聚集索引也依赖于有序的数据

  可能会二次查询(回表)：这应该是非聚集索引最大的缺点了，当查询到索引对应的主键或指针后会根据主键重新查询数据文件。

非聚集索引一定会回表么？

- 如果要查询的字段刚好建立的索引，那么索引的key的本身就是该字段，直接返回即可，无需回表查询

  **覆盖索引**

  - 如果一个索引覆盖所有需要查询的字段的值，我们就称之为覆盖索引，这种情况不需要进行回表操作

  **覆盖索引即需要查询的字段正好是索引的字段，那么根据该索引，可以直接查询到数据，无需回表**

索引创建原则

- 单列索引

  单列索引既由一列属性字段组成的索引

- 联合索引(多列索引)

  联合索引即多个字段联合组成的索引(联合索引相当于是给多个字段添加了相同的索引)

- 最左前缀原则

  当查询条件只有最左边是联合索引的首个字段时，联合索引才会生效，因此在创建索引和查询条件上面都金量将最频繁使用的字段属性作为最左边的字段(第一个字段)。

  ``mysql8.0不遵循最左原则时索引也会生效``

索引创建注意点

1. 尽管新版本的mysql不遵循最左原则索引也会生效，但最好还是遵循最左原则，以免版本更迭带来的麻烦

2. **选择合适的字段**

   不为null的字段，应该选择数据尽量不为null的字段。

3. **查询频繁的字段**

   索引的创建字段应该是查询比较频繁的字段

4. **经常作为条件的字段**

   经常被作为where条件的字段应该考虑建立索引

5. **经常被用于连接的字段**

   经常被用于连接查询的字段，可以添加索引以加速查询效率

不适合创建索引的字段

1. **频繁被更新的字段应该慎重建立索引**

2. **不经常被查询的字段没有必要创建索引**

3. **尽可能建立联合索引而不是单列索引**

   因为建立索引是需要耗费磁盘空间的，如果一个表的字段过多，索引过多，那么耗费的空间也会很多，如果是联合索引，多个字段在一个索引上，会一定程度上节约很多空间，并且修改数据的效率也会提升

4. **避免冗余的索引**

   索引A包含(name,age)两个属性字段，索引B包含(name)属性字段，索引能够命中B的情况下也一定会命中A，所以B索引就是冗余索引。

5. **在字符串类型的字段上面尽量考虑使用前缀索引而不是普通索引**

索引一定能够提升查询速度么？

- 大多数情况下，索引都比全表扫描要快，但是如果表的数据量不大，使用索引带来的提升也不会太大
